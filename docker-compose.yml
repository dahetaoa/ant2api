services:
  ant2api:
    image: dahetao/ant2api:latest
    container_name: ant2api
    ports:
      - "8045:8045"
    volumes:
      - ./data:/app/data
    environment:
      # ===== 服务器配置 =====
      - HOST=0.0.0.0
      - PORT=8045
      - DATA_DIR=./data
      - TIMEOUT=180000

      # ===== 认证安全 =====
      - WEBUI_PASSWORD=changeme
      - API_KEY=sk-123456

      # ===== 功能配置 =====
      - ENDPOINT_MODE=production
      - API_USER_AGENT=antigravity/1.11.17 windows/amd64

      # ===== 调试配置 =====
      - DEBUG=off
      # Go 内存回收：使用 MADV_DONTNEED，让容器内存曲线更快回落（可能增加少量 page fault）
      - GODEBUG=madvdontneed=1
      # Go 内存软限制：让 runtime 更积极地进行 GC 和内存归还（不是硬限制，不会导致 OOM）
      - GOMEMLIMIT=100MiB
    restart: unless-stopped
